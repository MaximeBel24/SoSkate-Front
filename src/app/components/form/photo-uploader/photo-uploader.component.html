<div class="photo-uploader">
  <!-- üìä Header avec compteur -->
  <div class="uploader-header">
    <h3 class="uploader-title">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
        <circle cx="8.5" cy="8.5" r="1.5" />
        <polyline points="21 15 16 10 5 21" />
      </svg>
      Photos {{ photoType() === 'GALLERY' ? 'de la galerie' : '' }}
    </h3>
    <span class="photo-counter" [class.photo-counter-full]="!canAddMore()">
      {{ totalPhotos() }} / {{ maxPhotos() }}
    </span>
  </div>

  <!-- üì§ Zone de drop -->
  @if (canAddMore()) {
    <div
      class="drop-zone"
      [class.drop-zone-dragging]="isDragging()"
      [class.drop-zone-disabled]="isUploading()"
    >
      <input
        #fileInput
        type="file"
        class="file-input"
        [accept]="acceptedFormatsString()"
        multiple
        (change)="onFileSelected($event)"
        [disabled]="isUploading() || !canAddMore()"
      />

      <div class="drop-zone-content">
        <!-- Icon -->
        <div class="drop-zone-icon">
          @if (isDragging()) {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="48"
              height="48"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="7 10 12 15 17 10" />
              <line x1="12" y1="15" x2="12" y2="3" />
            </svg>
          } @else {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="48"
              height="48"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
              <circle cx="8.5" cy="8.5" r="1.5" />
              <polyline points="21 15 16 10 5 21" />
            </svg>
          }
        </div>

        <!-- Text -->
        <div class="drop-zone-text">
          @if (isDragging()) {
            <p class="drop-zone-title">D√©posez vos images ici</p>
          } @else {
            <p class="drop-zone-title">
              Glissez vos images ici ou
              <button
                type="button"
                class="drop-zone-button"
                (click)="fileInput.click()"
                [disabled]="isUploading()"
              >
                cliquez pour s√©lectionner
              </button>
            </p>
            <p class="drop-zone-subtitle">
              PNG, JPG, WEBP ‚Ä¢ Max {{ constraints().maxSizeMB }} MB ‚Ä¢ Min
              {{ constraints().minWidth }}x{{ constraints().minHeight }}px
            </p>
            <p class="drop-zone-info">
              Encore {{ remainingSlots() }}
              {{ remainingSlots() > 1 ? 'photos possibles' : 'photo possible' }}
            </p>
          }
        </div>
      </div>
    </div>
  }

  <!-- üì∏ Photos existantes (mode √©dition) -->
  @if (existingPhotos().length > 0) {
    <div class="photos-section">
      <h4 class="section-subtitle">Photos actuelles</h4>
      <div class="photos-grid">
        @for (photo of existingPhotos(); track photo.id) {
          <div class="photo-card photo-card-existing">
            <img
              [src]="photo.thumbnailUrl || photo.url"
              [alt]="photo.originalFileName"
              class="photo-preview"
            />
            <div class="photo-overlay">
              <button
                type="button"
                class="photo-delete-btn"
                (click)="deleteExistingPhoto(photo.id)"
                [disabled]="isUploading()"
                title="Supprimer cette photo"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="3 6 5 6 21 6" />
                  <path
                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                  />
                </svg>
              </button>
            </div>
            <div class="photo-info">
              <span class="photo-size">{{ photo.formattedFileSize }}</span>
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- üñºÔ∏è Aper√ßu des photos s√©lectionn√©es -->
  @if (selectedFiles().length > 0) {
    <div class="photos-section">
      <h4 class="section-subtitle">
        Photos √† uploader ({{ selectedFiles().length }})
      </h4>
      <div class="photos-grid">
        @for (photoFile of selectedFiles(); track $index) {
          <div
            class="photo-card"
            [class.photo-card-invalid]="!photoFile.isValid"
          >
            <img
              [src]="photoFile.preview"
              [alt]="photoFile.file.name"
              class="photo-preview"
            />
            <div class="photo-overlay">
              <button
                type="button"
                class="photo-delete-btn"
                (click)="removeSelectedFile($index)"
                [disabled]="isUploading()"
                title="Retirer cette photo"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <line x1="18" y1="6" x2="6" y2="18" />
                  <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
              </button>
            </div>
            <div class="photo-info">
          <span class="photo-name" [title]="photoFile.file.name">
            {{ photoFile.file.name }}
          </span>
              @if (!photoFile.isValid) {
                <span class="photo-error">{{ photoFile.errorMessage }}</span>
              } @else {
                <span class="photo-size">
            {{ photoService.formatFileSize(photoFile.file.size) }}
          </span>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- ‚ö†Ô∏è Message si limite atteinte -->
  @if (!canAddMore() && selectedFiles().length === 0) {
    <div class="limit-message">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="12" cy="12" r="10" />
        <line x1="12" y1="8" x2="12" y2="12" />
        <line x1="12" y1="16" x2="12.01" y2="16" />
      </svg>
      <span>
      Limite de {{ maxPhotos() }} photos atteinte. Supprimez des photos
      existantes pour en ajouter de nouvelles.
    </span>
    </div>
  }

  <!-- üìä Barre de progression -->
  @if (isUploading()) {
    <div class="upload-progress">
      <div class="progress-bar">
        <div
          class="progress-fill"
          [style.width.%]="uploadProgress()"
        ></div>
      </div>
      <span class="progress-text">Upload en cours...</span>
    </div>
  }
</div>
