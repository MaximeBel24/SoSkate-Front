<div class="form-container">
  <!-- Header -->
  <app-form-header
    [title]="spotId() ? 'Modifier un spot' : 'Créer un spot'"
    [subtitle]="spotId() ? 'Mettez à jour les informations du spot' : 'Ajoutez un nouveau lieu de skateboard'"
  />

  <!-- Form -->
  <form [formGroup]="spotForm" (ngSubmit)="submit()" class="form-body">

    <!-- Section: Informations générales -->
    <app-form-section title="Informations générales">
      <ng-template #icon>
        <app-icon-info [size]="20" />
      </ng-template>

      <div class="form-grid">
        <!-- Nom -->
        <app-form-input
          label="Nom du spot"
          inputId="name"
          formControlName="name"
          placeholder="Ex: Skatepark de Bercy"
          [required]="true"
          [fullWidth]="true"
          [hasError]="spotForm.get('name')?.invalid ?? false"
          [touched]="spotForm.get('name')?.touched ?? false"
          errorMessage="Le nom est requis"
        />

        <!-- Description -->
        <app-form-textarea
          label="Description"
          textareaId="description"
          formControlName="description"
          placeholder="Décrivez le spot: type de modules, niveau requis, particularités..."
          [rows]="5"
          [required]="true"
          [hasError]="spotForm.get('description')?.invalid ?? false"
          [touched]="spotForm.get('description')?.touched ?? false"
          errorMessage="La description est requise"
        />
      </div>
    </app-form-section>

    <!-- Section: Localisation -->
    <app-form-section title="Localisation">
      <ng-template #icon>
        <app-icon-location [size]="20" />
      </ng-template>

      <div class="form-grid">
        <!-- Adresse -->
        <app-form-input
          label="Adresse"
          inputId="address"
          formControlName="address"
          placeholder="Ex: 12 Rue de Bercy"
          [required]="true"
          [fullWidth]="true"
          [hasError]="spotForm.get('address')?.invalid ?? false"
          [touched]="spotForm.get('address')?.touched ?? false"
          errorMessage="L'adresse est requise"
        />

        <!-- Ville -->
        <app-form-input
          label="Ville"
          inputId="city"
          formControlName="city"
          placeholder="Ex: Paris"
          [required]="true"
          [hasError]="spotForm.get('city')?.invalid ?? false"
          [touched]="spotForm.get('city')?.touched ?? false"
          errorMessage="La ville est requise"
        />

        <!-- Code postal -->
        <app-form-input
          label="Code postal"
          inputId="zipCode"
          formControlName="zipCode"
          placeholder="Ex: 75012"
          maxlength="5"
          [required]="true"
          [hasError]="spotForm.get('zipCode')?.invalid ?? false"
          [touched]="spotForm.get('zipCode')?.touched ?? false"
          errorMessage="Le code postal est requis"
        />

        <!-- Latitude -->
        <app-form-input
          label="Latitude"
          inputId="latitude"
          type="number"
          formControlName="latitude"
          placeholder="Ex: 48.8566"
          step="0.000001"
          [required]="true"
          [hasError]="spotForm.get('latitude')?.invalid ?? false"
          [touched]="spotForm.get('latitude')?.touched ?? false"
          errorMessage="La latitude est requise"
        />

        <!-- Longitude -->
        <app-form-input
          label="Longitude"
          inputId="longitude"
          type="number"
          formControlName="longitude"
          placeholder="Ex: 2.3522"
          step="0.000001"
          [required]="true"
          [hasError]="spotForm.get('longitude')?.invalid ?? false"
          [touched]="spotForm.get('longitude')?.touched ?? false"
          errorMessage="La longitude est requise"
        />
      </div>
    </app-form-section>

    <!-- Section: Caractéristiques -->
    <app-form-section title="Caractéristiques">
      <ng-template #icon>
        <app-icon-activity [size]="20" />
      </ng-template>

      <div class="form-grid">
        <!-- Type de spot -->
        <app-form-select
          label="Type de spot"
          selectId="isIndoor"
          formControlName="isIndoor"
          [options]="spotTypeOptions"
          placeholder="Sélectionnez un type"
          [required]="true"
          [hasError]="spotForm.get('isIndoor')?.invalid ?? false"
          [touched]="spotForm.get('isIndoor')?.touched ?? false"
          errorMessage="Le type de spot est requis"
        />

        <!-- Statut -->
        <app-form-select
          label="Statut"
          selectId="isActive"
          formControlName="isActive"
          [options]="statusOptions"
          placeholder="Sélectionnez un statut"
          [required]="true"
          [hasError]="spotForm.get('isActive')?.invalid ?? false"
          [touched]="spotForm.get('isActive')?.touched ?? false"
          errorMessage="Le statut est requis"
        />
      </div>

      <!-- Info cards - Type de spot -->
      <div class="info-cards">
        <app-info-card
          title="Spot Extérieur"
          description="Accessible en plein air, dépendant de la météo"
          [isActive]="spotForm.get('isIndoor')?.value === false"
        >
          <ng-template #icon>
            <app-icon-sun [size]="24" />
          </ng-template>
        </app-info-card>

        <app-info-card
          title="Spot Intérieur"
          description="Protégé des intempéries, praticable toute l'année"
          [isActive]="spotForm.get('isIndoor')?.value === true"
        >
          <ng-template #icon>
            <app-icon-home [size]="24" />
          </ng-template>
        </app-info-card>
      </div>

      <!-- Info cards - Statut -->
      <div class="info-cards">
        <app-info-card
          title="Spot Actif"
          description="Visible sur l'application mobile, les utilisateurs peuvent le sélectionner"
          [isActive]="spotForm.get('isActive')?.value === true"
        >
          <ng-template #icon>
            <app-icon-check-circle [size]="24" />
          </ng-template>
        </app-info-card>

        <app-info-card
          title="Spot Inactif"
          description="Masqué aux utilisateurs, non disponible à la sélection"
          [isActive]="spotForm.get('isActive')?.value === false"
        >
          <ng-template #icon>
            <app-icon-ban [size]="24" />
          </ng-template>
        </app-info-card>
      </div>
    </app-form-section>

    <!-- Section: Photos -->
    <app-form-section title="Galerie photos">
      <ng-template #icon>
        <app-icon-image [size]="20" />
      </ng-template>

      <app-photo-uploader
        [entityType]="PhotoEntityType.SPOT"
        [entityId]="spotId() ?? null"
        [photoType]="PhotoType.GALLERY"
        [maxPhotos]="20"
        [existingPhotos]="existingPhotos()"
        (photosSelected)="onPhotosSelected($event)"
        (photoDeleted)="onPhotoDeleted($event)"
        (uploadComplete)="onUploadComplete($event)"
        (uploadError)="onUploadError($event)"
      />
    </app-form-section>

    <!-- Form Actions -->
    <app-form-actions
      [cancelLink]="['..', 'list']"
      [submitText]="spotId() ? 'Mettre à jour' : 'Créer le spot'"
      [isLoading]="isLoading()"
      [isInvalid]="spotForm.invalid"
    />

    <!-- Validation Summary -->
    <app-validation-summary
      [isInvalid]="spotForm.invalid"
      [isTouched]="spotForm.touched"
    />
  </form>
</div>

<app-confirmation-modal
  [isOpen]="updateModal.isOpen"
  [type]="'update'"
  [title]="'Confirmer la mise à jour'"
  [message]="'Êtes-vous sûr de vouloir enregistrer les modifications apportées à ce spot ?'"
  [confirmText]="'Mettre à jour'"
  [cancelText]="'Annuler'"
  [isLoading]="updateModal.isLoading"
  (confirm)="confirmUpdate()"
  (cancel)="closeUpdateModal()"
  (close)="closeUpdateModal()"
/>
