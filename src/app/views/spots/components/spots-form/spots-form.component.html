<div class="form-container">
  <!-- Header -->
  <div class="form-header">
    <h2 class="form-title">
      {{ spotId() ? "Modifier" : "Créer" }} un spot
    </h2>
    <p class="form-subtitle">
      {{ spotId() ? "Mettez à jour les informations du spot" : "Ajoutez un nouveau lieu de skateboard" }}
    </p>
  </div>

  <!-- Form -->
  <form [formGroup]="spotForm" (ngSubmit)="submit()" class="form-body">
    <!-- Section: Informations générales -->
    <div class="form-section">
      <h3 class="section-title">
        <app-icon-info [size]="20" />
        Informations générales
      </h3>

      <div class="form-grid">
        <!-- Nom -->
        <div class="form-group full-width">
          <label for="name" class="form-label">
            Nom du spot <span class="required">*</span>
          </label>
          <input
            formControlName="name"
            id="name"
            type="text"
            class="form-input"
            placeholder="Ex: Skatepark de Bercy"
            [class.input-error]="spotForm.get('name')?.invalid && spotForm.get('name')?.touched"
          />
          @if (spotForm.get('name')?.invalid && spotForm.get('name')?.touched) {
            <span class="error-message">Le nom est requis</span>
          }
        </div>

        <!-- Description -->
        <div class="form-group full-width">
          <label for="description" class="form-label">
            Description <span class="required">*</span>
          </label>
          <textarea
            formControlName="description"
            id="description"
            rows="5"
            class="form-input form-textarea"
            placeholder="Décrivez le spot: type de modules, niveau requis, particularités..."
            [class.input-error]="spotForm.get('description')?.invalid && spotForm.get('description')?.touched"
          ></textarea>
          @if (spotForm.get('description')?.invalid && spotForm.get('description')?.touched) {
            <span class="error-message">La description est requise</span>
          }
        </div>
      </div>
    </div>

    <!-- Section: Localisation -->
    <div class="form-section">
      <h3 class="section-title">
        <app-icon-location [size]="20" />
        Localisation
      </h3>

      <div class="form-grid">
        <!-- Adresse -->
        <div class="form-group full-width">
          <label for="address" class="form-label">
            Adresse <span class="required">*</span>
          </label>
          <input
            formControlName="address"
            id="address"
            type="text"
            class="form-input"
            placeholder="Ex: 12 Rue de Bercy"
            [class.input-error]="spotForm.get('address')?.invalid && spotForm.get('address')?.touched"
          />
          @if (spotForm.get('address')?.invalid && spotForm.get('address')?.touched) {
            <span class="error-message">L'adresse est requise</span>
          }
        </div>

        <!-- Ville -->
        <div class="form-group">
          <label for="city" class="form-label">
            Ville <span class="required">*</span>
          </label>
          <input
            formControlName="city"
            id="city"
            type="text"
            class="form-input"
            placeholder="Ex: Paris"
            [class.input-error]="spotForm.get('city')?.invalid && spotForm.get('city')?.touched"
          />
          @if (spotForm.get('city')?.invalid && spotForm.get('city')?.touched) {
            <span class="error-message">La ville est requise</span>
          }
        </div>

        <!-- Code postal -->
        <div class="form-group">
          <label for="zipCode" class="form-label">
            Code postal <span class="required">*</span>
          </label>
          <input
            formControlName="zipCode"
            id="zipCode"
            type="text"
            class="form-input"
            placeholder="Ex: 75012"
            maxlength="5"
            [class.input-error]="spotForm.get('zipCode')?.invalid && spotForm.get('zipCode')?.touched"
          />
          @if (spotForm.get('zipCode')?.invalid && spotForm.get('zipCode')?.touched) {
            <span class="error-message">Le code postal est requis</span>
          }
        </div>

        <!-- Latitude -->
        <div class="form-group">
          <label for="latitude" class="form-label">
            Latitude <span class="required">*</span>
          </label>
          <input
            formControlName="latitude"
            id="latitude"
            type="number"
            step="0.000001"
            class="form-input"
            placeholder="Ex: 48.8566"
            [class.input-error]="spotForm.get('latitude')?.invalid && spotForm.get('latitude')?.touched"
          />
          @if (spotForm.get('latitude')?.invalid && spotForm.get('latitude')?.touched) {
            <span class="error-message">La latitude est requise</span>
          }
        </div>

        <!-- Longitude -->
        <div class="form-group">
          <label for="longitude" class="form-label">
            Longitude <span class="required">*</span>
          </label>
          <input
            formControlName="longitude"
            id="longitude"
            type="number"
            step="0.000001"
            class="form-input"
            placeholder="Ex: 2.3522"
            [class.input-error]="spotForm.get('longitude')?.invalid && spotForm.get('longitude')?.touched"
          />
          @if (spotForm.get('longitude')?.invalid && spotForm.get('longitude')?.touched) {
            <span class="error-message">La longitude est requise</span>
          }
        </div>
      </div>
    </div>

    <!-- Section: Caractéristiques -->
    <div class="form-section">
      <h3 class="section-title">
        <app-icon-activity [size]="20" />
        Caractéristiques
      </h3>

      <div class="form-grid">
        <!-- Type de spot -->
        <div class="form-group">
          <label for="isIndoor" class="form-label">
            Type de spot <span class="required">*</span>
          </label>
          <select
            formControlName="isIndoor"
            id="isIndoor"
            class="form-select"
            [class.input-error]="spotForm.get('isIndoor')?.invalid && spotForm.get('isIndoor')?.touched"
          >
            <option [ngValue]="null" disabled>Sélectionnez un type</option>
            <option [ngValue]="false">Extérieur (Street / Outdoor)</option>
            <option [ngValue]="true">Intérieur (Indoor)</option>
          </select>
          @if (spotForm.get('isIndoor')?.invalid && spotForm.get('isIndoor')?.touched) {
            <span class="error-message">Le type de spot est requis</span>
          }
        </div>

        <!-- Statut -->
        <div class="form-group">
          <label for="isActive" class="form-label">
            Statut <span class="required">*</span>
          </label>
          <select
            formControlName="isActive"
            id="isActive"
            class="form-select"
            [class.input-error]="spotForm.get('isActive')?.invalid && spotForm.get('isActive')?.touched"
          >
            <option [ngValue]="null" disabled>Sélectionnez un statut</option>
            <option [ngValue]="true">Actif (visible sur l'application)</option>
            <option [ngValue]="false">Inactif (masqué)</option>
          </select>
          @if (spotForm.get('isActive')?.invalid && spotForm.get('isActive')?.touched) {
            <span class="error-message">Le statut est requis</span>
          }
        </div>
      </div>

      <!-- Info cards - Type de spot -->
      <div class="info-cards">
        <div
          class="info-card"
          [class.info-card-active]="spotForm.get('isIndoor')?.value === false"
        >
          <app-icon-sun [size]="24" />
          <div>
            <h4>Spot Extérieur</h4>
            <p>Accessible en plein air, dépendant de la météo</p>
          </div>
        </div>

        <div
          class="info-card"
          [class.info-card-active]="spotForm.get('isIndoor')?.value === true"
        >
          <app-icon-home [size]="24" />
          <div>
            <h4>Spot Intérieur</h4>
            <p>Protégé des intempéries, praticable toute l'année</p>
          </div>
        </div>
      </div>

      <!-- Info cards - Statut -->
      <div class="info-cards">
        <div
          class="info-card"
          [class.info-card-active]="spotForm.get('isActive')?.value === true"
        >
          <app-icon-check-circle [size]="24" />
          <div>
            <h4>Spot Actif</h4>
            <p>Visible sur l'application mobile, les utilisateurs peuvent le sélectionner</p>
          </div>
        </div>

        <div
          class="info-card"
          [class.info-card-active]="spotForm.get('isActive')?.value === false"
        >
          <app-icon-ban [size]="24" />
          <div>
            <h4>Spot Inactif</h4>
            <p>Masqué aux utilisateurs, non disponible à la sélection</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Section: Photos -->
    <div class="form-section">
      <h3 class="section-title">
        <app-icon-image [size]="20" />
        Galerie photos
      </h3>

      <app-photo-uploader
        [entityType]="PhotoEntityType.SPOT"
        [entityId]="spotId() ?? null"
        [photoType]="PhotoType.GALLERY"
        [maxPhotos]="20"
        [existingPhotos]="existingPhotos()"
        (photosSelected)="onPhotosSelected($event)"
        (photoDeleted)="onPhotoDeleted($event)"
        (uploadComplete)="onUploadComplete($event)"
        (uploadError)="onUploadError($event)"
      />
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button
        type="button"
        class="btn btn-secondary"
        [routerLink]="['..', 'list']"
        [disabled]="isLoading()"
      >
        <app-icon-arrow-left [size]="18" />
        Annuler
      </button>

      <button
        type="submit"
        class="btn btn-premium"
        [disabled]="spotForm.invalid || isLoading()"
      >
        @if (isLoading()) {
          <span class="spinner"></span>
          <span>Enregistrement...</span>
        } @else {
          <app-icon-check [size]="18" />
          <span>{{ spotId() ? "Mettre à jour" : "Créer le spot" }}</span>
        }
      </button>
    </div>

    <!-- Form validation summary -->
    @if (spotForm.invalid && spotForm.touched) {
      <div class="validation-summary">
        <app-icon-alert-circle [size]="18" />
        <span>Veuillez corriger les erreurs avant de soumettre le formulaire</span>
      </div>
    }
  </form>
</div>

<app-confirmation-modal
  [isOpen]="updateModal.isOpen"
  [type]="'update'"
  [title]="'Confirmer la mise à jour'"
  [message]="'Êtes-vous sûr de vouloir enregistrer les modifications apportées à ce spot ?'"
  [confirmText]="'Mettre à jour'"
  [cancelText]="'Annuler'"
  [isLoading]="updateModal.isLoading"
  (confirm)="confirmUpdate()"
  (cancel)="closeUpdateModal()"
  (close)="closeUpdateModal()"
/>
